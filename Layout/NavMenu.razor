@using ComfyGrimoire.Services
@inject HistoryService HistoryService
@implements IDisposable

<MudNavMenu Class="mud-width-full">
    <MudText Typo="Typo.h6" Class="px-4 py-2" Color="Color.Primary">History</MudText>
    
    @if (!HistoryService.Items.Any())
    {
        <MudText Typo="Typo.body2" Class="px-4 py-2" Color="Color.Secondary">No history yet.</MudText>
    }
    else
    {
        @foreach (var item in HistoryService.Items)
        {
            <MudNavLink OnClick="@(() => SelectItem(item))" Icon="@Icons.Material.Filled.Image" IconColor="Color.Default">
                <div class="d-flex flex-column">
                    <MudText Typo="Typo.body2" Style="font-weight: bold;">@item.FileName</MudText>
                    <MudText Typo="Typo.caption">@item.Timestamp.ToString("HH:mm:ss")</MudText>
                </div>
            </MudNavLink>
        }
    }
</MudNavMenu>

@code {
    protected override void OnInitialized()
    {
        HistoryService.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        HistoryService.OnChange -= StateHasChanged;
    }

    private void SelectItem(HistoryItem item)
    {
        HistoryService.SelectItem(item);
    }
}
